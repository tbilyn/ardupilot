# Shulika, MPU STM32F407ZG


MCU STM32F4xx STM32F407xx

APJ_BOARD_ID 2223

OSCILLATOR_HZ 25000000

define HAL_CUSTOM_CLOCK_TREE
STM32_HSE_ENABLED TRUE
STM32_PLLM_VALUE 25
STM32_PLLN_VALUE 336
STM32_PLLP_VALUE 2
STM32_PLLQ_VALUE 7
STM32_PLLSRC STM32_PLLSRC_HSE

STM32_ST_USE_TIMER 5

FLASH_SIZE_KB 1024

FLASH_RESERVE_START_KB 64

define HAL_STORAGE_SIZE 15360
define STORAGE_FLASH_PAGE 2

# ??
#STDOUT_SERIAL SD2
#STDOUT_BAUDRATE 57600

USB_STRING_MANUFACTURER "APLviv"
USB_STRING_PRODUCT "%BOARD%"


# The normal usage of this ordering is:
# 1) SERIAL0: console (primary mavlink, usually USB)
# 2) SERIAL1: telem1
# 3) SERIAL2: telem2
# 4) SERIAL3: primary GPS
# 5) SERIAL4: GPS2
# 6) SERIAL5: extra UART (usually RTOS debug console)

# order of UARTs (and USB)
SERIAL_ORDER OTG1 USART2 USART1 USART6 EMPTY UART5


# ---------- PINS ----------

# Battery Voltage two-resistors 10k/1k
PA4 BATT_VOLTAGE_SENS ADC1 SCALE(1)

# USB
PA11 OTG_FS_DM OTG1
PA12 OTG_FS_DP OTG1

# USB detection ??
PB12 VBUS INPUT OPENDRAIN

# USART1
PB6 USART1_TX USART1
PB7 USART1_RX USART1

# USART2
PA2 USART2_TX USART2
PA3 USART2_RX USART2

# UART4
PA0 UART4_TX UART4
PA1 UART4_RX UART4

# UART5
PC12 UART5_TX UART5
PD2 UART5_RX UART5

# USART6
PC6 USART6_TX USART6
PC7 USART6_RX USART6

I2C_ORDER I2C2

# I2C 2
PF1 I2C2_SCL I2C2
PF0 I2C2_SDA I2C2

# These are the pins for SWD debugging with a STlinkv2 or black-magic probe.
PA13 JTMS-SWDIO SWD
PA14 JTCK-SWCLK SWD

define HAL_BARO_ALLOW_INIT_NO_BARO
define ALLOW_ARM_NO_COMPASS
define HAL_COMPASS_DEFAULT HAL_COMPASS_NONE

BARO BMP280 I2C:0:0x76

IMU Invensense I2C:0:0x11 ROTATION_NONE
# spi1 bus for IMU
PA5 SPI1_SCK SPI1
PA6 SPI1_MISO SPI1
PA7 SPI1_MOSI SPI1

PC2 MPU6000_CS CS
SPIDEV mpu6000   SPI1 DEVID1 MPU6000_CS MODE3 1*MHZ 8*MHZ 

# Now we start defining some PWM pins. We also map these pins to GPIO
# values, so users can set BRD_PWM_COUNT to choose how many of the PWM
# outputs on the primary MCU are setup as PWM and how many as
# GPIOs. To match HAL_PX4 we number the GPIOs for the PWM outputs
# starting at 50.
#PE14 TIM1_CH4 TIM1 PWM(1) GPIO(50)
#PE13 TIM1_CH3 TIM1 PWM(2) GPIO(51)
#PE11 TIM1_CH2 TIM1 PWM(3) GPIO(52)
#PE9  TIM1_CH1 TIM1 PWM(4) GPIO(53)
#PD13 TIM4_CH2 TIM4 PWM(5) GPIO(54)
#PD14 TIM4_CH3 TIM4 PWM(6) GPIO(55)

#define BOARD_PWM_COUNT_DEFAULT 4




